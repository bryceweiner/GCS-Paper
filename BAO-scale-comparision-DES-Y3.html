import { useState } from 'react';

const BAOScaleDebug = () => {
  // Constants
  const gamma = 1.89e-29;    // s⁻¹
  const t0 = 4.355751e17;    // s
  
  // Reference values at z=0.835
  const des_central = 18.920;
  const des_error = 0.510;
  const lcdm_ref = 20.100;
  
  // Calculate values for a range around z=0.835
  const z_points = [0.8, 0.835, 0.87].map(z => {
    const t = t0 * (1 - z/(1 + z));
    const lcdm = lcdm_ref * Math.sqrt(1+z) * (0.835/z);
    const suppression = Math.exp(-gamma * t);
    const qbu = lcdm * suppression;
    
    return {
      z,
      t,
      lcdm,
      qbu,
      suppression: (1 - qbu/lcdm) * 100
    };
  });

  // Find ranges needed
  const y_values = z_points.flatMap(p => [
    p.lcdm,
    p.qbu,
    des_central + des_error,
    des_central - des_error
  ]);
  
  const y_min = Math.min(...y_values);
  const y_max = Math.max(...y_values);

  // Calculate the SVG dimensions
  const svgWidth = 600;
  const svgHeight = 400;
  const margin = { top: 20, right: 20, bottom: 40, left: 60 };
  const chartWidth = svgWidth - margin.left - margin.right;
  const chartHeight = svgHeight - margin.top - margin.bottom;

  // Create scales for x and y axes
  const xScale = (x) => (x - 0.8) * (chartWidth / 0.07);
  const yScale = (y) => chartHeight - ((y - y_min) / (y_max - y_min)) * chartHeight;

  return (
    <div>
      <pre style={{fontFamily: 'monospace'}}>
        Data Point Values:
        {z_points.map(p => `
          z = ${p.z.toFixed(3)}:
          ΛCDM = ${p.lcdm.toFixed(4)}
          QBU = ${p.qbu.toFixed(4)}
          Suppression = ${p.suppression.toFixed(2)}%
        `).join('\n')}
        DES Y3 Range:
        Central: ${des_central}
        - Error: ${des_central - des_error}
        + Error: ${des_central + des_error}
        Required Plot Ranges:
        Y minimum: ${y_min}
        Y maximum: ${y_max}
      </pre>
      {/* Visualization */}
      <svg width={svgWidth} height={svgHeight}>
        <g transform={`translate(${margin.left}, ${margin.top})`}>
          {/* Axes */}
          <line x1={0} y1={chartHeight} x2={chartWidth} y2={chartHeight} stroke="black" />
          <line x1={0} y1={0} x2={0} y2={chartHeight} stroke="black" />

          {/* ΛCDM line */}
          <path
            d={`M${xScale(z_points[0].z)},${yScale(z_points[0].lcdm)}L${xScale(z_points[1].z)},${yScale(z_points[1].lcdm)}L${xScale(z_points[2].z)},${yScale(z_points[2].lcdm)}`}
            stroke="blue"
            fill="none"
          />

          {/* QBU line */}
          <path
            d={`M${xScale(z_points[0].z)},${yScale(z_points[0].qbu)}L${xScale(z_points[1].z)},${yScale(z_points[1].qbu)}L${xScale(z_points[2].z)},${yScale(z_points[2].qbu)}`}
            stroke="orange"
            fill="none"
          />

          {/* DES Y3 data point */}
          <circle cx={xScale(0.835)} cy={yScale(des_central)} r={3} fill="green" />
          <line
            x1={xScale(0.835)}
            y1={yScale(des_central - des_error)}
            x2={xScale(0.835)}
            y2={yScale(des_central + des_error)}
            stroke="green"
          />
        </g>
      </svg>
    </div>
  );
};

export default BAOScaleDebug;
